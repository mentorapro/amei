{"files":[{"id":"134171d0-9984-49c6-a0f7-cc5605c9e5e9","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Sao_Paulo\",\n  \"dependencies\": {\n    \"enabledAdvancedServices\": []\n  },\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"},{"id":"e94a8d57-6f9e-48e0-9597-07c309498602","name":"main","type":"server_js","source":"var currentDate \u003d new Date();\n\nfunction doGet(e) {\n  let parameters \u003d e.parameter;\n  let template \u003d HtmlService.createTemplateFromFile(\u0027index\u0027);\n  template.param \u003d parameters.amei;\n  return template.evaluate()\n    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);;\n}\n\nfunction include(filename) {\n  return HtmlService.createHtmlOutputFromFile(filename).getContent();\n}\n\nfunction getSheet(sheetName, workSheet) {\n  var sheetId \u003d DriveApp.getFoldersByName(\u0027automatizacao\u0027).next().getFoldersByName(\u0027agenda\u0027).next().getFilesByName(sheetName).next().getId();\n  var ss \u003d SpreadsheetApp.openById(sheetId);\n  return ss.setActiveSheet(ss.getSheetByName(workSheet));\n}\n\nasync function getHours(providerId) {\n  var uri \u003d baseUrl + uris.getAllDocuments;\n  var path \u003d paths.hours.replace(\u0027{id}\u0027, providerId);\n  var docAux \u003d await getAll(uri, path);\n  return docAux.data;\n}\n\nasync function getEvents(providerId) {\n  var uri \u003d baseUrl + uris.getAllDocuments;\n  var path \u003d `${paths.providers}/${providerId}/events`;\n  var docAux \u003d await getAll(uri, path);\n  return docAux.data;\n}\n\nasync function getProviders(amei) {\n  subscriptionId \u003d amei;\n  var uri \u003d baseUrl + uris.getAllDocuments;\n  var path \u003d paths.providers;\n  var docAux \u003d (await getAll(uri, path)).data;\n  var providers \u003d [];\n\n  for (let i \u003d 0; i \u003c docAux.length; i++) {\n    p \u003d docAux[i];\n    providers.push({\n      id: p.id,\n      calendar: p.calendar,\n      name: p.name,\n      cel: p.cel,\n      email: p.email,\n      func: p.func,\n      hours: getHours(p.id),\n      events: getEvents(p.id)\n    });\n  }\n\n  return returnObject(false, \u0027\u0027, providers);\n}\n\nasync function getServices(amei) {\n  try {\n    subscriptionId \u003d amei;\n    var uri \u003d baseUrl + uris.getAllDocuments;\n    var path \u003d paths.services;\n    return await getAll(uri, path);\n  } catch (err) {\n    return response(true, err.message, null);\n  }\n}\n\nasync function getAllowedHours(date, provider) {\n  var dateParsed \u003d new Date(`${date}T03:00:00`);\n  var dateTimeArr \u003d [];\n  var allowedHours \u003d [];\n\n  var hours \u003d provider.hours[dateParsed.getDay()].values;\n\n  hours.forEach((hour) \u003d\u003e {\n    var newDate \u003d new Date(`${date}T${hour}`);\n    dateTimeArr.push(newDate);\n  });\n\n  try {\n    var calendar \u003d CalendarApp.getCalendarById(provider.calendar);\n    var dayEvents \u003d calendar.getEventsForDay(dateParsed);\n    var eventsStart \u003d [];\n\n    if (dayEvents \u003c\u003d 0)\n      return response(false, \u0027success\u0027, hours);\n    else {\n      dayEvents.forEach((event) \u003d\u003e {\n        var startTime \u003d event.getStartTime();\n        var endTime \u003d event.getEndTime();\n        var timeStart \u003d `${startTime.getHours().toString().padStart(2, \u00270\u0027)}:${startTime.getMinutes().toString().padStart(2, \u00270\u0027)}`;\n        eventsStart.push(timeStart);\n        for (let i \u003d 0; i \u003c dateTimeArr.length; i++) {\n          var time \u003d dateTimeArr[i];\n          var timeString \u003d `${time.getHours().toString().padStart(2, \u00270\u0027)}:${time.getMinutes().toString().padStart(2, \u00270\u0027)}`;\n          var index \u003d allowedHours.findIndex(value \u003d\u003e value \u003d\u003d timeString);\n          if ((time \u003e\u003d startTime \u0026\u0026 time \u003c endTime) || index \u003e -1)\n            continue;\n\n          allowedHours.push(timeString);\n        }\n      })\n    }\n\n    allowedHours \u003d allowedHours.filter(value \u003d\u003e !eventsStart.includes(value));\n\n    return response(false, \u0027success\u0027, allowedHours);\n\n  } catch (err) {\n    return response(true, err.message, null);\n  }\n}\n\nasync function setSchedulle(order) {\n  try {\n    var uri \u003d baseUrl + uris.createDoc;\n    subscriptionId \u003d order.amei;\n    if (order.consumer.id \u003d\u003d \u0027\u0027) {\n      var client \u003d {\n        name: order.consumer.name,\n        cel: order.consumer.cel,\n        email: order.consumer.email\n      }\n\n      order.consumer.id \u003d (await save(uri, paths.client, client)).data;\n    }\n    var maxValues \u003d getServiceMaxDuration(order.selectedServices);\n    var eventId \u003d createCalendarEvent(order, maxValues).getId();\n    var event \u003d { event: eventId };\n\n    await save(uri, `${paths.client}/${order.consumer.id}/events`, event);\n    await save(baseUrl + uris.createDoc, `${paths.providers}/${order.provider.id}/events`, event);\n\n    return response(false, \u0027success\u0027, order.consumer);\n  } catch (err) {\n    return response(true, err.message, null);\n  }\n\n}\n\nfunction getServiceMaxDuration(services) {\n  var setWeights \u003d [];\n  var setDurations \u003d [];\n\n  services.forEach((service) \u003d\u003e {\n    setWeights.push(parseInt(service.unityWeight));\n  });\n\n  var maxWeight \u003d setWeights.sort((a, b) \u003d\u003e a - b).reverse()[0];\n\n  services.forEach((service) \u003d\u003e {\n    if (service.unityWeight \u003d\u003d maxWeight) {\n      setDurations.push(service.duration);\n    }\n  });\n\n  var maxDuration \u003d setDurations.sort((a, b) \u003d\u003e a - b).reverse()[0];\n\n  return {\n    maxDuration: maxDuration,\n    maxWeight: maxWeight\n  };\n}\n\nfunction createCalendarEvent(order, maxValues) {\n  var services \u003d [];\n  order.selectedServices.forEach((service) \u003d\u003e {\n    services.push(service.name);\n  });\n  var calendar \u003d CalendarApp.getCalendarById(order.provider.calendar);\n\n  if (calendar) {\n    var startTime \u003d new Date(`${order.date}T${order.hour}`);\n    var endTime \u003d new Date(getEndTime(startTime.getTime(), maxValues));\n    var desc \u003d `Cliente::${order.consumer.name}.\\nServicos: ${services.toString()}\\n.Contato: ${order.consumer.cel}`;\n    return calendar.createEvent(`Atendimento :: ${order.consumer.name}`, startTime, endTime, {\n      description: desc,\n      guests: order.consumer.email,\n      sendInvites: true\n    });\n  }\n}\n\nfunction getEndTime(startTime, maxValues) {\n  var newDate \u003d new Date(startTime);\n  var duration \u003d maxValues.maxDuration;\n\n  switch (maxValues.maxWeight) {\n    case 1:\n      return newDate.setMinutes(newDate.getMinutes() + duration);\n    case 2:\n      return newDate.setHours(newDate.getHours() + duration);\n    case 3:\n      return newDate.setDate(newDate.getDate() + duration);\n    case 4:\n      var days \u003d duration * 30;\n      return newDate.setMonth(newDate.getMonth() + month);\n    case 5:\n      var days \u003d duration * 365;\n      return newDate.setYear(newDate.getYear() + days);\n  }\n}\n\nvar response \u003d (error, message, data) \u003d\u003e {\n  return {\n    hasError: error,\n    message: message,\n    data: data\n  }\n}\n\nasync function getClientByEmail(email, amei) {\n  try {\n    subscriptionId \u003d amei;\n    var uri \u003d baseUrl + uris.getDocumentByQuery;\n    var path \u003d paths.client;\n    var body \u003d queryRequest(\u0027email\u0027, \u0027\u003d\u003d\u0027, email, path);\n    return await callResource(uri, body);\n  } catch (err) {\n    return response(true, err.message, null);\n  }\n}\n"},{"id":"bf3bed7d-b202-41eb-aff3-8d9e23fc8fd8","name":"app.js","type":"html","source":"\u003cscript defer\u003e\n  var app \u003d angular.module(\u0027app\u0027, [\u0027angularMask\u0027]);  \n\n  app.controller(\u0027AppController\u0027, function AppController($scope) {\n    $scope.page \u003d 1;\n    $scope.providers \u003d [];\n    $scope.allowedHours \u003d [];\n    $scope.today \u003d new Date().toISOString().substring(0,10);\n    $scope.selectedDate \u003d $scope.today;\n\n    $scope.order \u003d {\n      date: undefined,\n      hour: \u0027\u0027,\n      consumer: {\n        id: \u0027\u0027,\n        name: \u0027\u0027,\n        cel: \u0027\u0027,\n        email: \u0027\u0027,\n        details:\u0027\u0027,\n      },\n      provider: null,\n      total: 0,\n      selectedServices: []\n    }\n\n    $scope.pages \u003d [\n      {number: 1, title: \u0027Dados Pessoais\u0027},\n      {number: 2, title: \u0027Seleção de Serviços\u0027},\n      {number: 3, title: \u0027Seleção de Data/Hora\u0027},\n      {number: 4, title: \u0027Confirmação do Agendamento\u0027},\n    ];\n\n    $scope.error \u003d {\n      hasError: false,\n      message: []\n    };\n\n    $scope.services \u003d [];\n\n    $scope.removeService \u003d function(service){\n      var index \u003d $scope.order.selectedServices.findIndex(s \u003d\u003e s.id \u003d\u003d service.id);\n\n      service.selected \u003d false;\n      $scope.order.total -\u003d service.price;\n      $scope.order.selectedServices.splice(index,1);\n    }\n\n    $scope.selectProvider \u003d function(provider){\n      $scope.providers.forEach((p) \u003d\u003e {p.selected \u003d false});\n      provider.selected \u003d !provider.selected;\n\n      if (provider.selected){\n        $scope.order.provider \u003d provider;\n        var today \u003d new Date();\n        getAllowedHours(today.toISOString().substring(0,10), provider);\n      }\n      else\n        $scope.provider \u003d undefined;\n    }\n\n    $scope.selectService \u003d function(service){\n      var index \u003d $scope.order.selectedServices.findIndex(s \u003d\u003e s.id \u003d\u003d service.id);\n      if (index \u003e -1) return;\n\n      service.selected \u003d true;\n      $scope.order.total +\u003d service.price;\n      $scope.order.selectedServices.push(service);\n    }\n\n    $scope.nextPage \u003d function(currentPage){\n      validate();\n      $scope.page++;\n    }\n\n    $scope.prevPage \u003d function(currentPage){\n      $scope.page--;\n    }\n\n    var validate \u003d function(){\n    $scope.error.message \u003d [];\n\n    if ($scope.order.consumer.name \u003d\u003d \u0027\u0027)\n      $scope.error.message.push(\u0027O campo nome não pode ficar vazio!\u0027);\n\n    if ($scope.order.consumer.celular \u003d\u003d \u0027\u0027)\n      $scope.error.message.push(\u0027O campo celular não pode ficar vazio!\u0027);\n    \n    if ($scope.order.consumer.email \u003d\u003d \u0027\u0027)\n      $scope.error.message.push(\u0027O campo email não pode ficar vazio!\u0027);\n\n    $scope.error.hasError \u003d $scope.error.message.length \u003e 0;\n\n    if($scope.error.hasError)\n      window.scrollTo(0,0);\n    }\n\n    $scope.schedulle \u003d function(){\n      google.script.run.withSuccessHandler((response) \u003d\u003e {\n        if (response.hasError)\n          console.log(response.message);\n        else{\n          $scope.order.consumer \u003d response.data;\n          window.localStorage.setItem(\u0027consumer\u0027, $scope.order.consumer.id);\n        }\n      }).setSchedulle($scope.order);\n    }\n\n    var getServices \u003d function(){\n      google.script.run.withSuccessHandler((response) \u003d\u003e {\n        if(response.hasError){\n          console.log(response.message);\n        }else{\n          $scope.services \u003d response.data;\n        }\n        $scope.$apply();\n      }).getServices($scope.getSessionStorage(\u0027amei\u0027));\n    }\n\n    var getProviders \u003d function(){\n      google.script.run.withSuccessHandler((response) \u003d\u003e {\n        if(response.hasError){\n          console.log(response.message);\n        }else{\n          $scope.providers \u003d response.data;\n        }\n        $scope.$apply();\n      }).getProviders($scope.getSessionStorage(\u0027amei\u0027));\n    }\n\n    var getAllowedHours \u003d function(data, provider){\n      $scope.isPast \u003d false;\n      if (new Date(data) \u003c new Date($scope.today)){\n        $scope.isPast \u003d true;\n        return;\n      }\n\n      $scope.allowedHours \u003d [];\n\n      google.script.run.withSuccessHandler((response) \u003d\u003e {\n        if (response.hasError)\n          console.log(response.message);\n        else{\n          $scope.allowedHours \u003d response.data;\n          $scope.$apply();\n        }\n      }).getAllowedHours(data, provider);\n    }\n\n    $scope.getClientByEmail \u003d function(){\n      google.script.run.withSuccessHandler((response) \u003d\u003e {\n        if (response.hasError)\n          console.log(response.message);\n        else if(Object.keys(response.data).length \u003e 0){\n          $scope.order.consumer \u003d response.data;\n          $scope.$apply();\n        }\n          \n      }).getClientByEmail($scope.order.consumer.email, $scope.order.amei);\n    }\n\n    var startModals \u003d () \u003d\u003e {\n      var modals \u003d document.querySelectorAll(\u0027.modal\u0027);\n      var instances \u003d M.Modal.init(modals, {});\n    }\n\n    var startComponents \u003d function(){\n      startModals();\n      var dateOptions \u003d\n        {\n          // Define the months in portuguese\n          months: [\u0027Jan\u0027, \u0027Fev\u0027, \u0027Mar\u0027, \u0027Abr\u0027, \u0027Mai\u0027, \u0027Jun\u0027, \u0027Jul\u0027, \u0027Ago\u0027, \u0027Set\u0027, \u0027Out\u0027, \u0027Nov\u0027, \u0027Dez\u0027],\n          // Define the months in portuguese\n          monthsFull: [\n              \u0027Janeiro\u0027,\n              \u0027Fevereiro\u0027,\n              \u0027Março\u0027,\n              \u0027Abril\u0027,\n              \u0027Maio\u0027,\n              \u0027Junho\u0027,\n              \u0027Julho\u0027,\n              \u0027Agosto\u0027,\n              \u0027Setembro\u0027,\n              \u0027Outubro\u0027,\n              \u0027Novembro\u0027,\n              \u0027Dezembro\u0027\n          ],\n          // Define the weekdays\n          weekdays: [\n              \u0027Domingo\u0027,\n              \u0027Segunda\u0027,\n              \u0027Terça\u0027,\n              \u0027Quarta\u0027,\n              \u0027Quinta\u0027,\n              \u0027Sexta\u0027,\n              \u0027Sábado\u0027\n          ],\n          // Labels\n          textDone: \u0027Feito\u0027,\n          textReset: \u0027Limpar\u0027,\n          textUpdate: \u0027Atualizar\u0027,\n          startingDay: 0,\n          format: \u0027YYYY-Mon-DD\u0027,\n          onupdate: (instance, value) \u003d\u003e {\n            $scope.order.date \u003d value.substring(0,10);\n            if(value !\u003d\u003d \u0027\u0027 \u0026\u0026 $scope.order.provider !\u003d null){\n              var selectedDate \u003d new Date(value);\n              getAllowedHours(value.substring(0,10), $scope.order.provider);\n            }\n          }\n        };\n\n      var elem \u003d document.querySelectorAll(\u0027.datepicker\u0027)[0];\n      jSuites.calendar(elem,dateOptions);\n      \n    }\n\n    $scope.selecHour \u003d function(hour){\n      $scope.order.hour \u003d hour;\n    }\n\n    $scope.getSessionStorage \u003d function(key){\n      return window.sessionStorage.getItem(key);\n    }\n\n    $scope.init \u003d function() {\n      setTenant();\n      startComponents();\n    }\n\n    var setTenant \u003d function(){\n      let tenant \u003d document.getElementsByName(\u0027amei\u0027)[0];\n\n      google.script.run.withSuccessHandler((response) \u003d\u003e {\n        if (!response.hasError){\n          window.sessionStorage.setItem(\u0027amei\u0027, response.data);\n          getServices();\n          getProviders();\n          $scope.order.amei \u003d response.data;\n        }\n      }).showData(tenant.value);\n    }\n  });\n\u003c/script\u003e"},{"id":"977dfac1-fa8d-4431-a83b-fa882b8768f5","name":"index","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1.0\"\u003e\n  \u003c!-- Compiled and minified CSS --\u003e\n  \u003clink rel\u003d\"stylesheet\" href\u003d\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css\"\u003e\n  \u003clink rel\u003d\"stylesheet\" href\u003d\"https://cdn.jsdelivr.net/npm/simple-jscalendar@1.4.4/source/jsCalendar.min.css\"\n    integrity\u003d\"sha384-44GnAqZy9yUojzFPjdcUpP822DGm1ebORKY8pe6TkHuqJ038FANyfBYBpRvw8O9w\" crossorigin\u003d\"anonymous\"\u003e\n  \u003clink href\u003d\"https://fonts.googleapis.com/icon?family\u003dMaterial+Icons\" rel\u003d\"stylesheet\"\u003e\n\n  \u003cscript src\u003d\"https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js\"\u003e\u003c/script\u003e\n  \u003c!-- Compiled and minified JavaScript --\u003e\n  \u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js\" defer\u003e\u003c/script\u003e\n  \u003cscript src\u003d\"https://cdn.jsdelivr.net/npm/simple-jscalendar@1.4.4/source/jsCalendar.min.js\"\n    integrity\u003d\"sha384-0LaRLH/U5g8eCAwewLGQRyC/O+g0kXh8P+5pWpzijxwYczD3nKETIqUyhuA8B/UB\" crossorigin\u003d\"anonymous\"\u003e\n  \u003c/script\u003e\n\n  \u003cscript src\u003d\"https://jsuites.net/v4/jsuites.js\"\u003e\u003c/script\u003e\n  \u003clink rel\u003d\"stylesheet\" href\u003d\"https://jsuites.net/v4/jsuites.css\" type\u003d\"text/css\" /\u003e\n  \u003c?!\u003d include(\u0027simplemask\u0027);?\u003e\n  \n  \u003cstyle\u003e\n    .jsCalendar table tr {\n      display: flex;\n      justify-content: center;\n    }\n\n    .calendar-schedule {\n      display: flex;\n    }\n\n    .active-date {\n      background-color: #7000FF;\n      border-radius: 18px;\n      color: #fff;\n    }\n\n    .btn,\n    .btn-flat {\n      border-radius: 100px;\n    }\n    .scrollable{\n      max-heigth: 300px;\n      overflow-y: auto;\n    }\n  \u003c/style\u003e\n\u003c/head\u003e\n\n\u003cbody ng-app\u003d\"app\"\u003e\n  \u003cinput type\u003d\"hidden\" name\u003d\u0027amei\u0027 value\u003d\u0027\u003c?\u003dparam?\u003e\u0027 /\u003e\n  \u003cdiv class\u003d\"container\" ng-controller\u003d\"AppController\"\u003e\n    \u003cdiv ng-show\u003d\"error.hasError\" class\u003d\"card-panel col s12 red accent-1\"\n      style\u003d\"display: flex; align-items: center;color: #b71c1c;\"\u003e\n      \u003ci class\u003d\"material-icons\"\u003eerror\u003c/i\u003e\n      \u003cdiv class\u003d\"row\" style\u003d\"margin-bottom:0;margin-left: 0\"\u003e\n        \u003cspan class\u003d\"col s12\" ng-repeat\u003d\"erro in error.message\"\u003e{{erro}}\u003c/span\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n    \u003cdiv class\u003d\"card-panel row z-depth-3\" ng-init\u003d\"init()\"\u003e\n      \u003cform id\u003d\"mp-schedule\" style\u003d\"position: relative;\"\u003e\n        \u003cdiv class\u003d\"header row\"\u003e\n          \u003ch4 class\u003d\"title\"\u003eAgenda\u003c/h4\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"body\"\u003e\n          \u003c?!\u003d include(\u0027dadosPessoais\u0027);?\u003e\n          \u003c?!\u003d include(\u0027servicos\u0027);?\u003e\n          \u003c?!\u003d include(\u0027agendamento\u0027);?\u003e\n          \u003c?!\u003d include(\u0027confirmation\u0027);?\u003e\n        \u003c/div\u003e\n      \u003c/form\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n  \u003c?!\u003d include(\u0027app.js\u0027);?\u003e\n\u003c/body\u003e\n\u003c/html\u003e"},{"id":"9756a2da-d965-4d8e-a644-951bedb37bf3","name":"dadosPessoais","type":"html","source":"\u003cdiv id\u003d\"content-form-1\" class\u003d\"personal-data row\" ng-show\u003d\"page \u003d\u003d 1\"\u003e\n  \u003cp\u003e\u003cstrong\u003e{{pages[0].title}}\u003c/strong\u003e\u003c/p\u003e\n  \u003cp\u003e\n    Para darmos inicio ao seu agendamento precisamos que você nos informe os seus dados pessoais.\u003cbr\u003e\n    \u003csup\u003eSe você já fez outros agendamentos utilize o mesmo e-mail.\u003c/sup\u003e\n  \u003c/p\u003e\n  \u003cdiv class\u003d\"col s12\"\u003e\n    \u003clabel for\u003d\"customer-email\"\u003eEmail *\u003c/label\u003e\n    \u003cinput type\u003d\"email\" class\u003d\"validate\" id\u003d\"customer-email\" ng-model\u003d\"order.consumer.email\" ng-blur\u003d\"getClientByEmail(order.consumer.email)\"/\u003e\n  \u003c/div\u003e\n  \u003cdiv class\u003d\"col s12\"\u003e\n    \u003clabel for\u003d\"customer-name\"\u003eNome *\u003c/label\u003e\n    \u003cinput type\u003d\"text\" \n      class\u003d\"validate\" \n      id\u003d\"customer-name\"\n      ng-model\u003d\"order.consumer.name\"/\u003e\n  \u003c/div\u003e\n  \u003cdiv class\u003d\"col s12\" style\u003d\"padding: 0;\"\u003e\n    \u003cdiv class\u003d\"col s12\"\u003e\n      \u003clabel for\u003d\"customer-celular\"\u003eCelular *\u003c/label\u003e\n      \u003cinput type\u003d\"text\" class\u003d\"validate\"\n        id\u003d\"customer-celular\"\n        ng-model\u003d\"order.consumer.cel\"\n        angular-mask\u003d\"(00) 00000-0000|(00) 0000-0000\" \n        maxlength\u003d\"15\"/\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n  \u003cdiv class\u003d\"footer col s12 section\" style\u003d\"margin-top:32px\"\u003e\n    \u003cbutton type\u003d\"button\" \n      class\u003d\"btn waves-effect waves-teal btn-flat right\" \n      ng-click\u003d\"nextPage(pages[0].number)\"\u003ePróximo\u003c/button\u003e\n  \u003c/div\u003e\n\u003c/div\u003e"},{"id":"edd12eb3-b00d-483c-9f89-18a14de9ab2f","name":"servicos","type":"html","source":"\u003cdiv class\u003d\"\"\u003e\n\u003c/div\u003e\n\u003cdiv id\u003d\"content-form-2\" class\u003d\"services row\" ng-show\u003d\"page \u003d\u003d 2\"\u003e\n  \u003cp\u003e\u003cstrong\u003e{{pages[1].title}}\u003c/strong\u003e\u003c/p\u003e\n  \u003cp\u003eNesta etapa você deverá selecionar os serviços que deseja atendimento.\u003c/p\u003e\n  \u003cdiv class\u003d\"col s12\"\u003e\n    \u003ctable\u003e\n      \u003cthead\u003e\n        \u003cth style\u003d\"width: 80px;\"\u003e\u003c/th\u003e\n        \u003cth\u003eServiço\u003c/th\u003e\n        \u003cth\u003ePreço\u003c/th\u003e\n        \u003cth style\u003d\"width: 80px;\"\u003e\u003c/th\u003e\n      \u003c/thead\u003e\n      \u003ctbody class\u003d\"scrollable\"\u003e\n        \u003ctr ng-repeat\u003d\"service in services\"\u003e\n          \u003ctd\u003e\n            \u003cbutton class\u003d\"btn btn-flat\" ng-click\u003d\"selectService(service)\"\u003e\n                \u003ci class\u003d\"material-icons\" ng-show\u003d\"!service.selected\"\u003eadd\u003c/i\u003e\n                \u003ci class\u003d\"material-icons\" ng-show\u003d\"service.selected\"\u003echeck\u003c/i\u003e\n              \u003c/button\u003e\n\n          \u003c/td\u003e\n          \u003ctd\u003e{{service.name}}\u003c/td\u003e\n          \u003ctd\u003eR$ {{service.price.toString().replace(\u0027.\u0027,\u0027,\u0027)}}\u003c/td\u003e\n          \u003ctd\u003e\u003cbutton class\u003d\"btn btn-flat red accent-1\"  ng-click\u003d\"removeService(service)\" ng-show\u003d\"service.selected\" style\u003d\"color: #ff1744 \"\u003e\n                \u003ci class\u003d\"material-icons\"\u003edelete\u003c/i\u003e\n              \u003c/button\u003e\n          \u003c/td\u003e\n        \u003c/tr\u003e\n        \u003ctr\u003e\n          \u003ctd colspan\u003d\"4\"\u003e\n            \u003ca class\u003d\"btn waves-effect teal lighten-5 btn-flat modal-trigger\" href\u003d\"#select-provider\"\n              style\u003d\"margin-right: 8px;\"\u003e\n              \u003cdiv\u003e\n                \u003cspan  ng-if\u003d\"order.provider !\u003d null\"\u003e{{order.provider.name}}\u003c/span\u003e\n                \u003cspan ng-if\u003d\"order.provider \u003d\u003d null\"\u003eSelecione um provedor\u003c/span\u003e\n              \u003c/div\u003e\n            \u003c/a\u003e\n          \u003c/td\u003e\n        \u003c/tr\u003e\n      \u003c/tbody\u003e\n    \u003c/table\u003e\n  \u003c/div\u003e\n  \u003cdiv class\u003d\"col s12 m6\"\u003e\n    \u003cdiv class\u003d\"col s6 card-panel teal lighten-2\" id\u003d\"customer-services-total\"\n      style\u003d\"color: #f8f8f8;padding:16px; position: absolute; top: 0; right: 0;\"\u003e\n      Total: \u003cspan class\u003d\"badge\" style\u003d\"color: #f8f8f8;\"\u003eR$ {{order.total.toString().replace(\u0027.\u0027,\u0027,\u0027)}}\u003c/span\u003e\u003c/span\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n  \u003cdiv class\u003d\"footer col s12 section\" style\u003d\"margin-top:32px\"\u003e\n    \u003cbutton type\u003d\"button\" class\u003d\"waves-effect waves-teal btn-flat left\" ng-click\u003d\"prevPage(pages[1].number)\"\u003eAnterior\u003c/button\u003e\n    \u003cbutton type\u003d\"button\" class\u003d\"waves-effect waves-teal btn-flat right\" ng-click\u003d\"nextPage(pages[1].number)\"\u003ePróximo\u003c/button\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv id\u003d\"select-provider\" class\u003d\"modal\" style\u003d\"max-width: 420px;\"\u003e\n  \u003ca class\u003d\"modal-close button-close\" href\u003d\"#!\"\u003e\n    \u003ci class\u003d\"material-icons\"\u003eclose\u003c/i\u003e\n  \u003c/a\u003e\n  \u003cdiv class\u003d\"modal-content\"\u003e\n    \u003ch6\u003e\u003cstrong\u003eSelectionar Prestador\u003c/strong\u003e\u003c/h6\u003e\n    \u003cul class\u003d\"collection\"\u003e\n      \u003cli class\u003d\"collection-item modal-close\" ng-click\u003d\"selectProvider(p)\" ng-repeat\u003d\"p in providers\"\u003e\n        \u003cspan class\u003d\"title\"\u003e{{p.name}}\u003c/span\u003e\n        \u003cp\u003e{{p.func}}\u003cbr\u003e\n        \u003c/p\u003e\n      \u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/div\u003e\n\u003c/div\u003e"},{"id":"bdda356a-4be4-414e-bb7e-e0c6999923ff","name":"agendamento","type":"html","source":"\u003cdiv id\u003d\"content-form-3\" class\u003d\"schedule row \" ng-show\u003d\"page \u003d\u003d 3\"\u003e\n  \u003cp\u003e\u003cstrong\u003e{{pages[2].title}}\u003c/strong\u003e\u003c/p\u003e\n  \u003cp\u003eNesta etapa você deverá selecionar a data e o horário do seu atendimento.\u003c/p\u003e\n  \u003cdiv class\u003d\"col s12\"\u003e\n    \u003cdiv class\u003d\"col s12 m6 l5\"\u003e\n      \u003cdiv class\u003d\"datepicker\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n    \u003cdiv class\u003d\"col s12 m3 l6\"\u003e\n      \u003cspan ng-show\u003d\"isPast\"\u003eDatas passadas não são permitidas.\u003c/span\u003e\n      \u003cspan class\u003d\"btn\" ng-show\u003d\"!isPast\" ng-repeat\u003d\"h in allowedHours track by $index\" ng-click\u003d\"selecHour(h)\" \n        style\u003d\u0027cursor:pointer; margin:4px\u0027 \n        ng-class\u003d\"{\u0027teal\u0027: (order.hour \u003d\u003d hour), \u0027teal lighten-5 black-text\u0027: (order.hour !\u003d\u003d h)}\"\u003e\n        \u003cspan class\u003d\"title\"\u003e{{h}}\u003c/span\u003e\n        \u003ca href\u003d\"#!\" class\u003d\"secondary-content\" ng-show\u003d\"order.hour \u003d\u003d h\"\u003e\u003ci class\u003d\"material-icons\"\u003echeck\u003c/i\u003e\u003c/a\u003e\n      \u003c/span\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n  \u003cdiv class\u003d\"footer col s12 section\" style\u003d\"margin-top:32px\"\u003e\n    \u003cbutton type\u003d\"button\" class\u003d\"waves-effect waves-teal btn-flat left\" ng-click\u003d\"prevPage(pages[2].number)\"\u003eAnterior\u003c/button\u003e\n    \u003cbutton type\u003d\"button\" class\u003d\"waves-effect waves-teal btn-flat right\" ng-click\u003d\"nextPage(pages[2].number)\"\u003ePróximo\u003c/button\u003e\n  \u003c/div\u003e\n\u003c/div\u003e"},{"id":"c7e9d13b-9cea-487d-a546-b93920915a38","name":"confirmation","type":"html","source":"\u003cdiv id\u003d\"content-form-3\" class\u003d\"schedule row \" ng-show\u003d\"page \u003d\u003d 4\"\u003e\n  \u003cp\u003e\u003cstrong\u003e{{pages[3].title}}\u003c/strong\u003e\u003c/p\u003e\n  \u003cdiv class\u003d\"col s12\"\u003e\n    \u003cdiv class\u003d\"col s12\"\u003e\n      \u003cdiv class\u003d\"col s12 card-panel\" style\u003d\"padding: 16px;\"\u003e\n        \u003cdl\u003e\n          \u003cdt\u003e\u003cstrong\u003eNome:\u003c/strong\u003e{{order.consumer.name}}\u003c/dd\u003e\n          \u003cdt\u003e\u003cstrong\u003eData:\u003c/strong\u003e{{order.date}}\u003c/dd\u003e\n          \u003cdt\u003e\u003cstrong\u003eHora:\u003c/strong\u003e{{order.hour}}\u003c/dd\u003e\n          \u003cdt\u003e\u003cstrong\u003eTotal:\u003c/strong\u003e R$ {{order.total.toString().replace(\u0027.\u0027,\u0027,\u0027)}}\u003c/dd\u003e\n        \u003c/dl\u003e\n        \u003cbutton class\u003d\"btn waves-effect waves-light teal\" id\u003d\"btn-agendar\" ng-click\u003d\"schedulle()\"\u003eAgendar\u003c/button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n    \u003cinput type\u003d\"hidden\" class\u003d\"datepicker\" name\u003d\"customerScheduleDate\" id\u003d\"customer-schedule-date\"/\u003e\n  \u003c/div\u003e\n  \u003cdiv class\u003d\"footer col s12 section\" style\u003d\"margin-top:32px\"\u003e\n    \u003cbutton type\u003d\"button\" class\u003d\"waves-effect waves-teal btn-flat left\" ng-click\u003d\"prevPage(pages[3].number)\"\u003eAnterior\u003c/button\u003e\n  \u003c/div\u003e\n\u003c/div\u003e"},{"id":"d9fcb6ec-42de-47cf-a5c0-695b814f8ed5","name":"simplemask","type":"html","source":"\u003cscript\u003e\n\u0027use strict\u0027;\nangular.module(\u0027angularMask\u0027, [])\n  .directive(\u0027angularMask\u0027, function () {\n    return {\n      restrict: \u0027A\u0027,\n      require: \u0027ngModel\u0027,\n      scope: {\n        isModelValueEqualViewValues: \u0027\u003d\u0027\n      },\n      link: function ($scope, el, attrs, model) {\n        $scope.$watch(function(){return attrs.angularMask;}, function(value) {\n          if (model.$viewValue !\u003d null){\n            model.$viewValue \u003d mask(String(model.$viewValue).replace(/\\D/g, \u0027\u0027));\n            el.val(model.$viewValue);\n          }\n        });\n\n        model.$formatters.push(function (value) {\n          return value \u003d\u003d\u003d null ? \u0027\u0027 : mask(String(value).replace(/\\D/g, \u0027\u0027));\n        });\n\n        model.$parsers.push(function (value) {\n          model.$viewValue \u003d mask(value);\n          var modelValue \u003d $scope.isModelValueEqualViewValues ? model.$viewValue : String(value).replace(/\\D/g, \u0027\u0027);\n          el.val(model.$viewValue);\n          return modelValue;\n        });\n\n        function mask(val) {\n          var format \u003d attrs.angularMask,\n          arrFormat \u003d format.split(\u0027|\u0027);\n\n          if (arrFormat.length \u003e 1) {\n            arrFormat.sort(function (a, b) {\n              return a.length - b.length;\n            });\n          }\n\n          if (val \u003d\u003d\u003d null || val \u003d\u003d \u0027\u0027) {\n            return \u0027\u0027;\n          }\n          var value \u003d String(val).replace(/\\D/g, \u0027\u0027);\n          if (arrFormat.length \u003e 1) {\n            for (var a in arrFormat) {\n              if (value.replace(/\\D/g, \u0027\u0027).length \u003c\u003d arrFormat[a].replace(/\\D/g, \u0027\u0027).length) {\n                format \u003d arrFormat[a];\n                break;\n              }\n            }\n          }\n          var newValue \u003d \u0027\u0027;\n          for (var nmI \u003d 0, mI \u003d 0; mI \u003c format.length;) {\n            if (!value[nmI]) {\n              break;\n            }\n            if (format[mI].match(/\\D/)) {\n              newValue +\u003d format[mI];\n            } else {\n              newValue +\u003d value[nmI];\n              nmI++;\n            }\n            mI++;\n          }\n          return newValue;\n        }\n      }\n    };\n  });\n\u003c/script\u003e"},{"id":"407f4522-7890-45b7-a29a-b1aed80b9213","name":"code","type":"server_js","source":"var baseUrl \u003d \"https://us-central1-amei-mp0.cloudfunctions.net\";\nvar subscriptionId \u003d \u0027\u0027;\n\nvar uris \u003d {\n  updateDoc: \u0027/updateDocument\u0027,\n  deleteDoc: \u0027/dropDocument\u0027,\n  getDoc: \u0027/getDocument\u0027,\n  createDoc: \u0027/createDocument\u0027,\n  getAllDocuments: \u0027/getAllDocuments\u0027,\n  getDocumentByQuery: \u0027/getQueriableDocument\u0027\n}\n\nvar paths \u003d {\n  providers: \"providers/list\",\n  services: \"services/list\",\n  hours: \"providers/list/{id}/hours\",\n  hour: \"providers/list/{id}/hours/{day}\",\n  client: \"clients/list\"\n};\n\nvar postRequest \u003d function(path, data, collectionable \u003d false) {\n  return {\n    subscriptionId: subscriptionId,\n    isCollection: collectionable,\n    path: path,\n    document: data\n  }\n}\n\nvar getRequest \u003d function(path){\n  return {\n    subscriptionId: subscriptionId,\n    path: path\n  }\n}\n\nvar returnObject \u003d function(isSuccess, message, data) {\n  return {\n    hasError: isSuccess,\n    message, message,\n    data: data\n  }\n}\n\nvar queryRequest \u003d function(field, operator, value, path){\n  return {\n    subscriptionId: subscriptionId,\n    path: path,\n    query: {\n      field: field,\n      operator: operator,\n      value: value\n    }\n  }\n}\n\nasync function callResource(uri, body) {\n  var response \u003d UrlFetchApp.fetch(uri, {\n    \u0027async\u0027: true,\n    \u0027method\u0027: \"post\",\n    \u0027contentType\u0027: \u0027application/json\u0027,\n    \u0027payload\u0027: JSON.stringify(body),\n  }).getContentText();  \n\n  return JSON.parse(response);\n}\n\nasync function save(uri, path, document, collectionable \u003d false){\n\n  try {\n    if(document.$$hashKey)\n      delete document.$$hashKey\n\n    var body \u003d postRequest(path, document, collectionable);\n    var response \u003d await callResource(uri, body);\n\n    if (response.success){\n      document.id \u003d response.id;\n      return returnObject(false, \u0027OK\u0027, document);\n    }\n      \n  } catch (err) {\n    return returnObject(true, err.message, null);\n  }\n}\n\nasync function getAll(uri, path){\n  try {\n    var body \u003d getRequest(path);\n    var response \u003d await callResource(uri, body);\n\n    if (response.success)\n      return returnObject(false, \u0027OK\u0027, response.data);\n\n  } catch (err) {\n    return returnObject(true, err.message,null);\n  }\n}\n\nasync function showData(tenant){\n  return getSubscriptionId(tenant);\n}\n\nasync function getSubscriptionId(tenant){\n  var uri \u003d baseUrl + uris.getDoc;\n  subscriptionId \u003d \u0027amei-admin\u0027;\n  var path \u003d tenant;\n\n  try {\n    var body \u003d getRequest(path);\n    var response \u003d await callResource(uri, body);\n    if (response.success){\n      var data \u003d response.data;\n      return returnObject(false, \u0027OK\u0027,data.tenantMail);\n    }\n      \n  } catch (err) {\n    return returnObject(true, err.message, null);\n  }\n  \n}\n\nfunction include(filename) {\n  return HtmlService.createHtmlOutputFromFile(filename).getContent();\n}"}]}
